name: Sign EXE File

on:
  workflow_dispatch:

jobs:
  sign:
    runs-on: windows-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Download Unsigned EXE
        uses: actions/download-artifact@v4
        with:
          name: unsigned-exe
          path: ./unsigned-exe

      - name: Sign the EXE Using Azure Trusted Signing
        uses: azure/trusted-signing-action@v0.5.1
        with:
          azure-tenant-id: ${{ secrets.AZURE_TENANT_ID }}
          azure-client-id: ${{ secrets.AZURE_CLIENT_ID }}
          azure-client-secret: ${{ secrets.AZURE_CLIENT_SECRET }}
          endpoint: https://eus.codesigning.azure.net/
          trusted-signing-account-name: your-account-name
          certificate-profile-name: your-certificate-profile
          files-folder: ./unsigned-exe
          files-folder-filter: exe
          file-digest: SHA256
          timestamp-rfc3161: http://timestamp.acs.microsoft.com
          timestamp-digest: SHA256

      - name: Upload Signed EXE
        uses: actions/upload-artifact@v4
        with:
          name: signed-exe
          path: ./unsigned-exe/Modelist.exe
